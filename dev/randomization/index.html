<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Randomization methods ¬∑ QuasiMonteCarlo.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/QuasiMonteCarlo/stable/randomization/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="QuasiMonteCarlo.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">QuasiMonteCarlo.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../samplers/">Sampler APIs</a></li><li class="is-active"><a class="tocitem" href>Randomization methods</a><ul class="internal"><li><a class="tocitem" href="#API"><span>API</span></a></li><li><a class="tocitem" href="#Scrambling-methods"><span>Scrambling methods</span></a></li><li class="toplevel"><a class="tocitem" href="#Unrandomized-low-discrepency-sequence"><span>Unrandomized low discrepency sequence</span></a></li><li class="toplevel"><a class="tocitem" href="#Randomized-version"><span>Randomized version</span></a></li><li class="toplevel"><a class="tocitem" href="#Setting-I-like-for-plotting"><span>Setting I like for plotting</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Randomization methods</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Randomization methods</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/QuasiMonteCarlo.jl/blob/master/docs/src/randomization.md" title="Edit on GitHub"><span class="docs-icon fab">ÔÇõ</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Randomization-methods"><a class="docs-heading-anchor" href="#Randomization-methods">Randomization methods</a><a id="Randomization-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Randomization-methods" title="Permalink"></a></h1><p>Most of the methods presented in <a href="@ref">sampler.jl Samplers</a> are deterministic i.e. <code>sample(n, d, Sampler()::DeterministicSamplingAlgorithm)</code> always produces the same sequence <span>$X = (X_1, \dots, X_n)$</span>.</p><p>The main issue with deterministic Quasi Monte Carlo sampling is that it does not allow easy error estimation as opposed to plain Monte Carlo where the variance can be estimated.</p><p>A Randomized Quasi Monte Carlo method must respect the two following criteria</p><ol><li>Have <span>$X_i\sim \mathbb{U}([0,1]^d)$</span> for each <span>$i\in \{1,\cdots, n\}$</span>.</li><li>Preserve the QMC (low discrepancy) properties of <span>$X$</span>.</li></ol><p>This randomized version can be used to obtain confidence interval or sensitivity analysis for example.</p><h2 id="API"><a class="docs-heading-anchor" href="#API">API</a><a id="API-1"></a><a class="docs-heading-anchor-permalink" href="#API" title="Permalink"></a></h2><p>To randomize one can directly use a sampling algorithm with a randomization method as <code>sample(n, d, DeterministicSamplingAlgorim(R = RandomizationMethod()))</code> or <code>sample(n, lb, up, DeterministicSamplingAlgorim(R = RandomizationMethod()))</code>.</p><p>Randomization methods can also be used independently, that is, given a matrix <span>$X$</span> (<span>$d\times n$</span>) of <span>$n$</span> points in dimension <span>$d$</span> in <span>$[0,1]^d$</span> one can directly randomize it using <code>randomize(x, ::RandomizationMethod())</code></p><article class="docstring"><header><a class="docstring-binding" id="QuasiMonteCarlo.randomize" href="#QuasiMonteCarlo.randomize"><code>QuasiMonteCarlo.randomize</code></a> ‚Äî <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">randomize(x, R::Shift)</code></pre><p>Cranley Patterson Rotation i.e. <code>y = (points .+ U) mod 1</code> where <code>U ‚àº ùïå([0,1]·µà)</code> and <code>points</code> is a <code>d√ón</code> matrix</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/QuasiMonteCarlo.jl/blob/753c0bccf6ba39323f2e08f87ddbae4abef711a5/src/RandomizedQuasiMonteCarlo/shifting.jl#L12-L15">source</a></section><section><div><pre><code class="nohighlight hljs">randomize(x, R::ScrambleMethod)</code></pre><p>Return a scrambled version of <code>x</code>.  The scramble methods implemented are </p><ul><li><code>DigitalShift</code>.</li><li><code>OwenScramble</code>: Nested Uniform Scramble which was introduced in Owen (1995).</li><li><code>MatousekScramble</code>: Linear Matrix Scramble which was introduced in Matousek (1998).</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/QuasiMonteCarlo.jl/blob/753c0bccf6ba39323f2e08f87ddbae4abef711a5/src/RandomizedQuasiMonteCarlo/scrambling_base_b.jl#L13-L21">source</a></section></article><h2 id="Scrambling-methods"><a class="docs-heading-anchor" href="#Scrambling-methods">Scrambling methods</a><a id="Scrambling-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Scrambling-methods" title="Permalink"></a></h2><p><code>ScramblingMethods(base, pad, rng)</code> are well suited for <span>$(t,m,d)$</span>-nets. <code>base</code> is the base used to scramble and <code>pad</code> the number of bits in <code>b</code>-ary decomposition i.e. <span>$y \simeq \sum_{k=1}^{\texttt{pad}} y_k/\texttt{base}^k $. `pad` is generally chosen as $\gtrsim \log_b(n)$</span>. The implemented <code>ScramblingMethods</code> are</p><ul><li><code>DigitalShift</code> the simplest and faster method. For a point <span>$x\in [0,1]^d$</span> it does <span>$y_k = (x_k + U_k) \mod b$</span> where <span>$U_k ‚àº \mathbb{U}(\{0, \cdots, b-1\})$</span></li></ul><article class="docstring"><header><a class="docstring-binding" id="QuasiMonteCarlo.DigitalShift" href="#QuasiMonteCarlo.DigitalShift"><code>QuasiMonteCarlo.DigitalShift</code></a> ‚Äî <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">DigitalShift</code></pre><p>Digital shift.  <code>randomize(x, R::DigitalShift)</code> returns a scrambled version of <code>x</code>. </p><p>The scramble method is Digital Shift. It scramble each corrdinate in base <code>b</code> as <code>y‚Çñ = (x‚Çñ + U‚Çñ) mod b</code> where <code>U‚Çñ ‚àº ùïå({0:b-1})</code>.  <code>U</code> is the same for every point <code>points</code> but i.i.d along every dimensions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SciML/QuasiMonteCarlo.jl/blob/753c0bccf6ba39323f2e08f87ddbae4abef711a5/src/RandomizedQuasiMonteCarlo/scrambling_base_b.jl#L210-L221">source</a></section></article><p>@docs   Shift</p><pre><code class="nohighlight hljs">
## Design Matrices

For numerous independent randomization, use `generate_design_matrices(n, d, ::DeterministicSamplingAlgorithm), ::RandomizationMethod, num_mats)` where `num_mats` is the number of independent `X` generated.</code></pre><p>@docs   generate<em>design</em>matrices</p><pre><code class="nohighlight hljs">
## Example

Randomization of a Faure sequence with various methods.
</code></pre><p>julia using QuasiMonteCarlo m = 4 d = 3 b = QuasiMonteCarlo.nextprime(d) N = b^m # Number of points pad = m # Can also choose something as <code>2m</code> to get &quot;better&quot; randomization</p><h1 id="Unrandomized-low-discrepency-sequence"><a class="docs-heading-anchor" href="#Unrandomized-low-discrepency-sequence">Unrandomized low discrepency sequence</a><a id="Unrandomized-low-discrepency-sequence-1"></a><a class="docs-heading-anchor-permalink" href="#Unrandomized-low-discrepency-sequence" title="Permalink"></a></h1><p>x_faure = QuasiMonteCarlo.sample(N, d, FaureSample())</p><h1 id="Randomized-version"><a class="docs-heading-anchor" href="#Randomized-version">Randomized version</a><a id="Randomized-version-1"></a><a class="docs-heading-anchor-permalink" href="#Randomized-version" title="Permalink"></a></h1><p>x<em>nus = randomize(x</em>faure, OwenScramble(base = b, pad = pad)) # equivalent to sample(N, d, FaureSample(R = OwenScramble(base = b, pad = pad))) x<em>lms = randomize(x</em>faure, MatousekScramble(base = b, pad = pad)) x<em>digital</em>shift = randomize(x<em>faure, DigitalShift(base = b, pad = pad)) x</em>shift = randomize(x<em>faure, Shift()) x</em>uniform = rand(d, N) # plain i.i.d. uniform</p><pre><code class="nohighlight hljs"></code></pre><p>julia using Plots</p><h1 id="Setting-I-like-for-plotting"><a class="docs-heading-anchor" href="#Setting-I-like-for-plotting">Setting I like for plotting</a><a id="Setting-I-like-for-plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-I-like-for-plotting" title="Permalink"></a></h1><p>default(fontfamily=&quot;Computer Modern&quot;, linewidth=1, label=nothing, grid=true, framestyle=:default)</p><pre><code class="nohighlight hljs">
Plot the resulting sequences along dimensions `1` and `3`.
</code></pre><p>julia d1 = 1 d2 = 3 # you can try every combination of dimension (d1, d2) sequences = [x<em>uniform, x</em>faure, x<em>shift, x</em>digital<em>shift, x</em>lms, x<em>nus] names = [&quot;Uniform&quot;, &quot;Faure (deterministic)&quot;, &quot;Shift&quot;, &quot;Digital Shift&quot;, &quot;Matousek Scramble&quot;, &quot;Owen Scramble&quot;] p = [plot(thickness</em>scaling=1.5, aspect_ratio=:equal) for i in sequences] for (i, x) in enumerate(sequences)     scatter!(p[i], x[d1, :], x[d2, :], ms=0.9, c=1, grid=false)     title!(names[i])     xlims!(p[i], (0, 1))     ylims!(p[i], (0, 1))     yticks!(p[i], [0, 1])     xticks!(p[i], [0, 1])     hline!(p[i], range(0, 1, step=1 / 4), c=:gray, alpha=0.2)     vline!(p[i], range(0, 1, step=1 / 4), c=:gray, alpha=0.2)     hline!(p[i], range(0, 1, step=1 / 2), c=:gray, alpha=0.8)     vline!(p[i], range(0, 1, step=1 / 2), c=:gray, alpha=0.8) end plot(p..., size=(1500, 900))</p><pre><code class="nohighlight hljs">
![Different randomize methods of the same initial set of points](../../img/various_randomization.svg)

Faure nets and scrambled versions of Faure nets are digital $(t,m,d)$-net ([see this nice book by A. Owen](https://artowen.su.domains/mc/qmcstuff.pdf)). It basically means that they have strong equipartition properties.
Here we can (visually) verify that with Nested Uniform Scrambling (it also works with Linear Matrix Scrambling and Digital Shift).
You must see one point per rectangle of volume $1/b^m$. Points on the &quot;left&quot; border of rectangles are included while those on the &quot;right&quot; are excluded.
</code></pre><p>julia begin     d1 = 1      d2 = 3 # you can try every combination of dimension (d1, d2)     x = x<em>nus # Owen Scramble, you can try x</em>lms and x<em>digital</em>shift     p = [plot(thickness<em>scaling=1.5, aspect</em>ratio=:equal) for i in 0:m]     for i in 0:m         j = m - i         x·µ¢ = range(0, 1, step=1 / b^(i))         x‚±º = range(0, 1, step=1 / b^(j))         scatter!(p[i+1], x[d1, :], x[d2, :], ms=2, c=1, grid=false)         xlims!(p[i+1], (0, 1.01))         ylims!(p[i+1], (0, 1.01))         yticks!(p[i+1], [0, 1])         xticks!(p[i+1], [0, 1])         hline!(p[i+1], x·µ¢, c=:gray, alpha=0.2)         vline!(p[i+1], x‚±º, c=:gray, alpha=0.2)     end     plot(p..., size=(1500, 900)) end ```</p><p><img src="../../../img/equidistribution.svg" alt="All the different elementary rectangle contain only one points"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../samplers/">¬´ Sampler APIs</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Tuesday 14 March 2023 00:20">Tuesday 14 March 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
